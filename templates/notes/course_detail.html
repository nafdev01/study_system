{% extends 'base.html' %}

{% block title %}{{ course.abbreviation }}{% endblock title %}

{% block content %}
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{% url 'dashboard' %}">Home</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            {{ course }}
        </li>
    </ol>
</nav>

<div class="container-fluid">
    <div class="d-flex justify-content-between mb-3">
        <button class="btn btn-sm btn-primary mx-2 d-flex flex-row justify-content-between align-items-center" data-bs-toggle="modal" data-bs-target="#termInlineModal">
            <i class="ti ti-circle-plus fs-5"></i>
            <span class="mx-1">Add Term </span>
            <i class="ti ti-vocabulary fs-5"></i>
        </button>

        <a class="btn btn-success" href="{% url 'create_domain' course.id %}">
            <i class="ti ti-plus fs-5"></i>
            Add Domain
        </a>
    </div>

    <p class="display-4 text-center text-dark mb-5">{{ course }}</p>

    <div class="row">
        <div class="col-lg-8 col-md-12 col-sm-12">
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        {% for domain in course.domains.all %}
                        <div class="col-lg-6 col-md-12 col-sm-12">
                            <div class="card domain-card" onclick="openDomain(this)"
                                data-url="{{ domain.get_absolute_url }}">
                                <div class="card-body">
                                    <h5 class="text-center">Domain&nbsp;{{domain.number}}.&nbsp;{{domain.name }}</h5>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-12 col-sm-12">
            <div class="card">
                <div class="card-body">
                    {% for term in terms %}
                    <button type="button" class="btn btn-sm btn-primary m-1 text-center" onclick="showDefinition(this)"
                        data-term="{{ term.name }}" data-definition="{{ term.definition }}">
                        {{ term.name }}
                    </button>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% include 'includes/create_term_inline.html' with entry=entry %}

{% endblock content %}

{% block custom_js %}
<script>
    function showDefinition(button) {
        // get the data-term and data-definition attributes
        var term = button.getAttribute('data-term');
        var definition = button.getAttribute('data-definition');

        silverBox({
            title: {
                alertIcon: "info",
                text: `${term}`,

            },
            text: `${definition}`,
            centerContent: true,
            timer: 7500,
            animation: {
                duration: 1000,
            }
        })
    }

</script>
<script>
    var courseId = "{{ course.id }}";

    var loc = window.location;
    if (loc.protocol == 'https:') {
        var wsStart = 'wss://'
    }
    else {
        var wsStart = 'ws://';
    }

    var termInlineAddress = `${wsStart}${window.location.host}/ws/term/inline/create/${courseId}/`;
    const termInlineSocket = new WebSocket(termInlineAddress);
    termInlineSocket.onopen = function (e) {
        console.log(`The connection was setup successfully to "${termInlineAddress}!`);
    };
    termInlineSocket.onclose = function (e) {
        console.log(`something unexpected happened when connecting to "${termInlineAddress}/" !`);
        console.log(`Error: ${e}`);
    };

    document.querySelector("#create-term-inline-btn").onclick = function (e) {
        var term = document.querySelector(
            "#term-inline-input"
        ).value;
        definition = document.querySelector(
            "#definition-inline-input"
        ).value;

        termInlineSocket.send(JSON.stringify({ term: term, definition: definition, course_id: courseId }));
    };
    termInlineSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);

        document.querySelector("#term-inline-input").value = "";
        document.querySelector("#definition-inline-input").value = "";

        silverBox({
            alertIcon: "success",
            position: "top-right",
            text: `You have successfully created the term ${data.term}`,
            centerContent: true,
            cancelButton: {
                text: "OK"
            }
        })

    };
</script>
{% endblock custom_js %}