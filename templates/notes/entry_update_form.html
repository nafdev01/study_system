<!-- notes/entry_update_form.html -->
{% extends "base.html" %}
{% load django_bootstrap5 %}

{% block title %}Update Entry{% endblock %}

{% block content %}
<div class="container-fluid">
	<h4 class="text-center display-5">{{ entry.name }}</h4>
	<p>Fill on the form fields as required</p>

	<div>
		<form method="post" onsubmit="return updateEntry(event)" id="entry-form">
			{% csrf_token %}
			<div class="mb-3">
				<label for="id_name" class="form-label">Name</label>
				<input type="text" class="form-control" id="id_name" name="name" required value="{{entry.name}}">
			</div>
			<div class="form-group mb-3">
				<label for="editor-container" class="form-label">Content</label>
				<!-- Hidden textarea to store Quill content -->
				<textarea id="id_content" name="content" style="display: none;">{{entry.content}}</textarea>
				<!-- Quill editor container -->
				<div id="editor-container" style="height: 300px; border-radius: 0.25rem;"></div>
			</div>
			<button class="btn btn-outline-success" type="submit" accesskey="s">Save Changes</button>
		</form>
	</div>
</div>

<script>
	// Initialize Quill editor
	const quill = new Quill('#editor-container', {
		theme: 'snow',
		modules: {
			toolbar: [
				['bold', 'italic', 'underline', 'strike'],
				['blockquote', 'code-block'],
				[{ 'header': [1, 2, 3, 4, 5, 6, false] }],
				[{ 'list': 'ordered'}, { 'list': 'bullet' }],
				[{ 'script': 'sub'}, { 'script': 'super' }],
				[{ 'indent': '-1'}, { 'indent': '+1' }],
				[{ 'direction': 'rtl' }],
				[{ 'size': ['small', false, 'large', 'huge'] }],
				[{ 'color': [] }, { 'background': [] }],
				[{ 'font': [] }],
				[{ 'align': [] }],
				['link', 'image'],
				['clean']
			]
		},
		placeholder: 'Write your content here...',
	});

	// Set existing content to Quill editor
	// We need to set the content using Quill's setContents to properly render HTML
	const contentTextarea = document.getElementById('id_content');
	quill.root.innerHTML = contentTextarea.value;

	function updateEntry(event) {
		event.preventDefault();
		const form = document.querySelector('#entry-form');
		const textarea = form.querySelector('#id_content');
		
		// Get content from Quill and update the hidden textarea
		textarea.value = quill.root.innerHTML;
		
		form.submit();
		return false;
	}
</script>
{% endblock %}